FROM python:3.13.5-bookworm AS builder

ARG POETRY_VERSION
RUN pip install poetry==${POETRY_VERSION}

WORKDIR /app
COPY pyproject.toml poetry.lock ./
# Poetry complains without a readme
RUN touch README.md
RUN poetry install --no-root

COPY src ./src
RUN poetry install

COPY data/venues.json .

RUN mkdir /run/secrets
RUN echo "bbf" > /run/secrets/db_secret

ENTRYPOINT ["poetry", "run", "python", "src/api/populate.py", "venues.json", "db", "bbf", "bbf", "/run/secrets/db_secret"]
